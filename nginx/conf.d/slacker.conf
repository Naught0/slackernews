# This is a sample Nginx configuration file.
# It's intended to be placed in the `/etc/nginx/sites-available/` directory
# and then symlinked to `/etc/nginx/sites-enabled/`.

# The 'server' block defines a virtual server to handle incoming requests.
server {
    # 'location /' matches all incoming requests for the root path.
    # This location block will not require a password.
    listen 80;
    listen [::]:80;

    location = / {
        proxy_pass http://anubis:8923/;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $host;
        real_ip_header CF-Connecting-IP;
        real_ip_recursive on;
    }
    
    # This location block matches all other incoming requests.
    location / {
        # 'proxy_pass' forwards requests to the Anubis service for AI bot protection
        proxy_pass http://anubis:8923/;

        # Standard proxy headers
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $host;
        real_ip_header CF-Connecting-IP;
        real_ip_recursive on;
    }
}

